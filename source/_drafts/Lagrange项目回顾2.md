---
title: Largrange项目架构与设计回顾 (二)
tags:
  - 架构
  - Kubernetes
  - Aliyun
  - Java
categories:
  - 设计
---

在[Largrange项目架构与设计回顾 (一)](/2020/05/09/lagrange项目回顾/) 里面我讲了一下项目开始架构和技术选型的一些内容。这一章来聊聊业务设计上的这点事。

总体来说项目设计的时候,我们对业务模块的划分和拆解总体上来说都是遵循着高内聚,低耦合的原则来进行划分的。大部分和业务相关的服务,都还是能很好的进行功能划分的。但是有一些和具体业务关联性并不是很高的服务在界定与实现时出现了一些问题。

## 任务调度服务

由于平台方面会有一些控制命令下发给Android设备,而且下发的命令并不一定都是实时的,大部分都是指定一个时间来下发,所以在设计的时候就考虑到需要一个任务调度服务(以下略称`cron`),来处理这些下发指令以及未来可能会有的定时批处理任务的业务需求。技术选型的时候考虑到整个服务是构建在Kubernetes上的一个分布式的微服务架构,所以就没有选择Spring Scheduler,而是使用了Quarter来支撑整个`cron`。 

从技术选型上来说`cron`没有什么问题,但是在设计如何使用`cron`上还是有点问题的, 我们先来看看已推送服务为例,整个平台中`cron`的处理流程是怎样的。

1. `Platform` 调用 `cron`的创建定时任务Job的接口(接口的参数为推送时使用的相关参数)
2. `cron` 创建Quartz的Job和Trigger,并将Job和Trigger的Name(Quartz中Job和Trigger的唯一标识符)返回个`Platform`
3. `cron` 在指定时间触发推送的Job,即调用`Push`服务的推送接口
4. `Push`的推送接口调用第三方服务商的推送服务,并将第三方推送服务的调用结果返回给`cron`
5. `cron`通过调用`Platform`预留的推送服务回调地址将第三方推送服务调用接口返还给`Platform`
6. `Platform` 将第三方推送服务的调用结果留档保存,并继续业务处理

设计之初考虑到不想在`cron`中牵扯到具体的业务, 所以设计了一个`Platform`的回调接口来处理推送后的具体业务处理。虽然在处理推
